<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Julia 学习笔记(七) | 模块开发 - 远程开发 | 学习空间</title><meta name="keywords" content="Julia"><meta name="author" content="Rex"><meta name="copyright" content="Rex"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Julia 模块远程开发教程，包括 GitHub 部署，测试文档覆盖率和包的注册等。">
<meta property="og:type" content="article">
<meta property="og:title" content="Julia 学习笔记(七) | 模块开发 - 远程开发">
<meta property="og:url" content="http://www.wzhecnu.cn/2022/10/25/programming/julia/julia-note-7-package/index.html">
<meta property="og:site_name" content="学习空间">
<meta property="og:description" content="Julia 模块远程开发教程，包括 GitHub 部署，测试文档覆盖率和包的注册等。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qiniu.wzhecnu.cn/WallPapers/julia.jpg">
<meta property="article:published_time" content="2022-10-25T15:02:27.000Z">
<meta property="article:modified_time" content="2023-12-02T15:52:35.333Z">
<meta property="article:author" content="Rex">
<meta property="article:tag" content="Julia">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qiniu.wzhecnu.cn/WallPapers/julia.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.wzhecnu.cn/2022/10/25/programming/julia/julia-note-7-package/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/iconfont.css"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Julia 学习笔记(七) | 模块开发 - 远程开发',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-02 23:52:35'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script>(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();</script><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">86</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://qiniu.wzhecnu.cn/WallPapers/julia.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">学习空间</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Julia 学习笔记(七) | 模块开发 - 远程开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发布于</span><time class="post-meta-date-created" datetime="2022-10-25T15:02:27.000Z" title="发布于 2022-10-25 23:02:27">2022-10-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-02T15:52:35.333Z" title="更新于 2023-12-02 23:52:35">2023-12-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>15分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Julia 笔记系列：</p>
<ul>
<li>『<a href="/2021/10/18/programming/julia/julia-intro/" title="Julia 基本使用及安装教程">Julia 基本使用及安装教程</a>』</li>
<li>『<a href="/2021/10/18/programming/julia/julia-note-1/" title="Julia 学习笔记(一) | 数据类型和函数">Julia 学习笔记(一) | 数据类型和函数</a>』</li>
<li>『<a href="/2021/10/31/programming/julia/julia-note-2/" title="Julia 学习笔记(二) | 类型，派发与设计模式">Julia 学习笔记(二) | 类型，派发与设计模式</a>』</li>
<li>『<a href="/2021/10/31/programming/julia/julia-note-3/" title="Julia 学习笔记(三) | 广播，性能和模块">Julia 学习笔记(三) | 广播，性能和模块</a>』</li>
<li>『<a href="/2021/11/24/programming/julia/julia-note-4-parallel/" title="Julia 学习笔记(四) | 并行计算(预备篇)">Julia 学习笔记(四) | 并行计算(预备篇)</a>』</li>
<li>『<a href="/2022/04/23/programming/julia/julia-note-5-package/" title="Julia 学习笔记(五) | 模块开发 - 基础篇">Julia 学习笔记(五) | 模块开发 - 基础篇</a>』</li>
<li>『<a href="/2022/02/19/programming/julia/julia-python/" title="Julia 学习笔记(番外) | 从 Python 到 Julia">Julia 学习笔记(番外) | 从 Python 到 Julia</a>』</li>
</ul>
<h2 id="唠唠闲话">唠唠闲话</h2>
<a href="/2022/04/23/programming/julia/julia-note-5-package/" title="Julia 学习笔记(五) | 模块开发 - 基础篇">上篇</a>介绍了模块开发的基础知识，本篇介绍一些远程开发相关的内容，包括 GitHub 部署，测试文档覆盖率和包的注册等。
<h3 id="概要">概要</h3>
<p>本篇内容包括：</p>
<ul>
<li><a href="#%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90">模板生成</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%EF%BC%8C%E6%96%87%E6%A1%A3%E5%92%8C%E8%A6%86%E7%9B%96%E7%8E%87">测试，文档和覆盖率</a></li>
<li><a href="#%E5%8C%85%E7%9A%84%E6%B3%A8%E5%86%8C">包的注册</a></li>
</ul>
<h2 id="模板生成">模板生成</h2>
<h3 id="PkgTemplate">PkgTemplate</h3>
<blockquote>
<p>推荐阅读：<a target="_blank" rel="noopener" href="https://juliaci.github.io/PkgTemplates.jl/stable/">PkgTemplates 官方文档</a></p>
</blockquote>
<p>一个完整的 Julia 模块应包括：主代码，代码测试和帮助文档等内容，而这些用 <code>PkgTemplates</code> 就能“一键生成”。</p>
<ol>
<li>
<p>调用模块</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># using Pkg; Pkg.add(&quot;PkgTemplates&quot;)</span></span><br><span class="line"><span class="keyword">using</span> PkgTemplates</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>用 <code>Template</code> 函数设置模板参数，并存入变量 <code>t</code></p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">t = Template(;</span><br><span class="line">    dir=<span class="string">&quot;.&quot;</span>,</span><br><span class="line">    plugins=[</span><br><span class="line">      License(; name=<span class="string">&quot;MIT&quot;</span>),</span><br><span class="line">      Git(; manifest=<span class="literal">false</span>, ssh=<span class="literal">true</span>),</span><br><span class="line">      GitHubActions(; x86=<span class="literal">true</span>, coverage=<span class="literal">true</span>),</span><br><span class="line">      Codecov(),</span><br><span class="line">      Documenter&#123;GitHubActions&#125;()</span><br><span class="line">    ])</span><br></pre></td></tr></table></figure>
<p>参数释义：</p>
<ul>
<li><code>dir</code> 指定创建模块的位置，默认为 <code>~/.julia/dev</code></li>
<li><code>plugins</code> 设置接口，也即常用的开发工具
<ul>
<li><code>License</code> 通过 <code>name</code> 参数选择了 MIT 许可证</li>
<li><code>Git</code> 设置忽略 <code>Mainfest.toml</code>，且用 <code>ssh</code> 链接 GitHub 仓库，默认方式是 https</li>
<li><code>GitHubActions</code> 启用对 <code>x86</code> 机器的支持，并启用 <code>coverage</code> 计算测试覆盖率</li>
<li><code>Codecov()</code> 对应上一选项的 <code>coverage=true</code></li>
<li><code>Documenter</code> 指定通过 GitHubActions 部署文档</li>
</ul>
</li>
</ul>
<p>每个参数更细致的用法参考 PkgTemplates 文档的 <a target="_blank" rel="noopener" href="https://juliaci.github.io/PkgTemplates.jl/stable/user/#Plugins-1">这一节</a>。</p>
</li>
<li>
<p>输入 <code>t(&quot;&lt;模块名&gt;&quot;)</code> 创建模块<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221026161913.png" alt="深度截图_选择区域_20221026161913"></p>
</li>
<li>
<p>查看模块文件结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TestPackage/</span><br><span class="line">├── docs</span><br><span class="line">│   ├── make.jl</span><br><span class="line">│   ├── Manifest.toml</span><br><span class="line">│   ├── Project.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── index.md</span><br><span class="line">├── LICENSE</span><br><span class="line">├── Manifest.toml</span><br><span class="line">├── Project.toml</span><br><span class="line">├── README.md</span><br><span class="line">├── src</span><br><span class="line">│   └── TestPackage.jl</span><br><span class="line">└── test</span><br><span class="line">   └── runtests.jl</span><br></pre></td></tr></table></figure>
<p>以及隐藏文件夹 <code>.github/</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TestPackage/.github/</span><br><span class="line">└── workflows</span><br><span class="line">   ├── CI.yml</span><br><span class="line">   ├── CompatHelper.yml</span><br><span class="line">   └── TagBot.yml</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>只用 <code>Template(;&lt;参数设置&gt;)(&quot;包名&quot;)</code> 这一行命令，上篇提到的内容就都生成了，包括：</p>
<ul>
<li>Git 环境及初始 commit</li>
<li>仓库常用的 <code>README.md</code>，<code>LICENSE</code> 和 <code>.gitignore</code></li>
<li>代码文档测试 <code>src/</code>，<code>docs/</code> 和 <code>test/</code></li>
<li>代码环境文件 <code>Project.toml</code> 和 <code>Manifest.toml</code></li>
<li>GitHub Actions 的配置文件 <code>.github/workflows/</code></li>
</ul>
<p>其他文件已介绍过就不再赘述，重点是 GitHub Actions 的配置文件：</p>
<ul>
<li><code>CompatHelper.yml</code>：自动检查和更新依赖版本，其会根据依赖环境的版本变化，向仓库提交 PR</li>
<li><code>TagBot.yml</code>：自动打包并发布新版本，在注册包的时候发挥作用</li>
<li><code>CI.yml</code>：CI 全称 Continuous Integration 的缩写，即持续集成</li>
</ul>
<p>前两个文件一般不需要修改，最后一个  <code>CI.yml</code> 涉及参数较多，且通常需要根据需求修改，下边着重介绍。</p>
<h3 id="CI-文件">CI 文件</h3>
<p>CI/CD 全称为 Continuous Integration/ Continuous Deployment，连续集成与连续部署，常见平台</p>
<table>
<thead>
<tr>
<th style="text-align:center">文件</th>
<th style="text-align:center">平台</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>gitlab-ci.yml</code></td>
<td style="text-align:center">gitlab</td>
</tr>
<tr>
<td style="text-align:center"><code>.github/workflows/xxx.yml</code></td>
<td style="text-align:center">github</td>
</tr>
<tr>
<td style="text-align:center"><code>.travis.yml</code></td>
<td style="text-align:center">travis CI</td>
</tr>
<tr>
<td style="text-align:center"><code>.appveyor.yml</code></td>
<td style="text-align:center">appveyor CI</td>
</tr>
</tbody>
</table>
<p>个人仅接触过 GitHub 平台，其他暂不讨论。下边以 QRDecoders （<a target="_blank" rel="noopener" href="https://github.com/JuliaImages/QRDecoders.jl/blob/master/.github/workflows/CI.yml">源文件</a>）为例，分段理解，边用边学，且只介绍比较重要或可能需要修改的部分。</p>
<p>第一部分，头部内容：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line"><span class="attr">concurrency:</span></span><br><span class="line">  <span class="comment"># Skip intermediate builds: always.</span></span><br><span class="line">  <span class="comment"># Cancel intermediate builds: only if it is a pull request build.</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.workflow</span> <span class="string">&#125;&#125;-$&#123;&#123;</span> <span class="string">github.ref</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">cancel-in-progress:</span> <span class="string">$&#123;&#123;</span> <span class="string">startsWith(github.ref,</span> <span class="string">&#x27;refs/pull/&#x27;</span><span class="string">)</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>name</code> 是当前 GitHub Action 的小标题</li>
<li><code>on</code> 的参数项 <code>push: branches:</code> 指定会触发测试的分支，即当我们向 <code>branches</code> 中的分支 <code>push</code> commit 时，将触发 CI。特别地，此处向 <code>master</code> 分支 <code>push</code> 会触发 CI。<strong>特别留意，<code>PkgTemplates</code> 生成 CI 文件的默认主分支名为 <code>main</code>，要根据仓库实际情况修改。</strong></li>
</ul>
<p>第二部分：模块测试的环境配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Julia</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.version</span> <span class="string">&#125;&#125;</span> <span class="bullet">-</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span> <span class="bullet">-</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.arch</span> <span class="string">&#125;&#125;</span> <span class="bullet">-</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event_name</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">fail-fast:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">version:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;1.6&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;1.7&#x27;</span></span><br><span class="line">        <span class="attr">os:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">arch:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">x64</span></span><br><span class="line">        <span class="attr">include:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">os:</span> <span class="string">windows-latest</span></span><br><span class="line">            <span class="attr">version:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">            <span class="attr">arch:</span> <span class="string">x64</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">os:</span> <span class="string">macOS-latest</span></span><br><span class="line">            <span class="attr">version:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">            <span class="attr">arch:</span> <span class="string">x64</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">os:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">            <span class="attr">version:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">            <span class="attr">arch:</span> <span class="string">x86</span></span><br></pre></td></tr></table></figure>
<p><code>jobs: test</code> 参数项下的 <code>strategy</code>，指定了测试环境，这里用了两种方式：</p>
<ul>
<li>前三个参数 <code>version, os, arch</code> 设置在 <code>x64</code> 架构的 <code>ubuntu-latest</code> 系统上，对 Julia <code>1.6</code> 和 <code>1.7</code> 版本分别执行测试，共 <code>2 * 1 * 1 = 2</code> 个测试</li>
<li>最后一个参数 <code>include</code> 的每条子项对应一个测试，分别指明了 Julia 版本和系统架构，<code>version</code> 默认取最新版本，比如目前 <code>1</code> 等同于 <code>1.8.2</code>，<code>1.6</code> 等同于 <code>1.6.7</code></li>
<li>测试系统设置越多，每次触发 CI 需要等待的时间可能就越长，所以通常还要根据实际情况调整</li>
</ul>
<p>此外， <code>name</code> 字段指定了 GitHub Actions 子项的名称由，如下图<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221026170249.png" alt="深度截图_选择区域_20221026170249"></p>
<p>第三部分，测试内容：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jobs:</span></span><br><span class="line"><span class="comment">#  test:</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/setup-julia@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">arch:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.arch</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/cache@v1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/julia-buildpkg@v1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/julia-runtest@v1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/julia-processcoverage@v1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">codecov/codecov-action@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">files:</span> <span class="string">lcov.info</span></span><br></pre></td></tr></table></figure>
<p><code>jobs: test: steps</code> 部分参数释义：</p>
<ul>
<li><code>julia-actions/setup-julia@v1</code> 启动 Julia</li>
<li><code>julia-actions/julia-buildpkg@v1</code> 编译 Julia 依赖环境</li>
<li><code>julia-actions/julia-runtest@v1</code> 执行测试，也即仓库下的 <code>test/runtests.jl</code> 文件</li>
<li><code>julia-actions/julia-processcoverage@v1</code> 计算覆盖率，主要为 <code>Codecov</code> 服务提供数据</li>
<li><code>codecov/codecov-action@v2</code> 触发 <code>Codecov</code> 服务，生成覆盖率报告</li>
</ul>
<p>对应到仓库中，显示信息如下<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221026171512.png" alt="20221026171512"></p>
<p>第四部分，文档参数：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jobs:</span></span><br><span class="line"><span class="comment">#  test:</span></span><br><span class="line">  <span class="attr">docs:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Documentation</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">write</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/setup-julia@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">version:</span> <span class="string">&#x27;1.6&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/julia-buildpkg@v1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">julia-actions/julia-docdeploy@v1</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">GITHUB_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          julia --project=docs -e &#x27;</span></span><br><span class="line"><span class="string">            using Documenter: DocMeta, doctest</span></span><br><span class="line"><span class="string">            using QRDecoders</span></span><br><span class="line"><span class="string">            DocMeta.setdocmeta!(QRDecoders, :DocTestSetup, :(using QRDecoders); recursive=true)</span></span><br><span class="line"><span class="string">            doctest(QRDecoders)&#x27;</span></span><br></pre></td></tr></table></figure>
<p><code>jobs: docs:</code> 部分参数释义：</p>
<ul>
<li><code>name</code> 指定 GitHub Actions 子项的名称</li>
<li><code>runs-on: ubuntu-latest</code> 指定在 <code>ubuntu-latest</code> 系统上生成文档</li>
<li><code>julia-actions/julia-docdeploy@v1</code> 这部分应该是在执行 <code>run</code> 参数的内容，实际执行内容与 <code>docs/make.jl</code> 有关</li>
<li>特别留意一项 <code>GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</code>，由于文档部署涉及对仓库的读写，这里要设置 <code>GITHUB_TOKEN</code>，允许 <code>Documenter</code> 对 <code>gh-pages</code> 分支的读写</li>
<li>其他参数与上一部分类似</li>
</ul>
<p>对应到仓库中，显示信息如下<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221026171412.png" alt="20221026171412"></p>
<p><strong>总之，留意 <code>push</code> 的默认分支，根据需求修改测试数目，其他基本不需要改动。</strong></p>
<p>关于 <code>Documenter</code> 的使用，以及 <code>GITHUB_TOKEN</code> 的设置，我们接下来进行介绍。</p>
<h3 id="DocumentTools">DocumentTools</h3>
<blockquote>
<p>推荐阅读：<a target="_blank" rel="noopener" href="https://juliadocs.github.io/Documenter.jl/stable/man/hosting/#GitHub-Actions">Documenter 文档</a> 以及 <a target="_blank" rel="noopener" href="https://docs.juliahub.com/DocumenterTools/GihxU/0.1.7/autodocs/">DocumenterTools 文档</a></p>
</blockquote>
<ol>
<li>
<p><strong>激活当前环境</strong>，输入模块名称，生成密钥</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> &lt;包名称&gt;</span><br><span class="line"><span class="keyword">using</span> DocumenterTools</span><br><span class="line">DocumenterTools.genkeys(&lt;包名称&gt;)</span><br></pre></td></tr></table></figure>
<p>注意<strong>不是输入字符串</strong>，而是将当前环境的 <code>模块名</code> 作为参数</p>
</li>
<li>
<p>根据提示内容复制第一部分密钥，建议先用 git 连接远端的 <code>GitHub</code> 仓库，这一来可以点击 <code>Info</code> 的链接直接跳转<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221004215341.png" alt="20221004215341"></p>
</li>
<li>
<p>进入仓库，点击设置，找到 <code>Deploy keys</code> 粘贴刚刚复制的内容<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221026172041.png" alt="20221026172041"></p>
<p>注意 ssh 密钥会赋予 <code>Documenter</code> 写入权限，所以注意是设置仓库密钥，不要设置成个人账号的密钥</p>
</li>
<li>
<p>其他参数参见 DocumenterTools 文档，比如修改 <code>user</code> 参数</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DocumenterTools.genkeys(; user=<span class="string">&quot;用户名&quot;</span>, repo=<span class="string">&quot;仓库名&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><code>docs/make.jl</code> 和文档 <code>docs/index.md</code> 的内容，下一章节一块介绍。</p>
<h2 id="测试，文档和覆盖率">测试，文档和覆盖率</h2>
<h3 id="代码测试">代码测试</h3>
<ol>
<li>
<p>Julia 规定测试代码放在 <code>test/</code> 目录下的文件 <code>runtests.jl</code> 中，在包模式下执行 <code>test</code> 会自动运行 <code>test/runtest.jl</code> 文件</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; <span class="comment"># 进入 shell 模式</span></span><br><span class="line">mkdir test</span><br><span class="line">touch test/runtests.jl</span><br></pre></td></tr></table></figure>
<p><img src="https://qiniu.wzhecnu.cn/PicBed2/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20220424162332.png" alt="深度截图_选择区域_20220424162332"></p>
</li>
<li>
<p>设置测试环境，也可以在 <code>Project.toml</code> 的 <code>extras</code> 中添加相应依赖</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">] <span class="comment"># 进入包管理模式</span></span><br><span class="line">activate test <span class="comment"># 切换环境到 test 目录</span></span><br><span class="line">add Test <span class="comment"># 添加测试库 Test</span></span><br></pre></td></tr></table></figure>
<p>如果在包环境下执行 <code>test</code> 报错 <code>cannot merge projects</code>，可能是测试环境的 <code>Manifest.toml</code> 与主环境重复了，删除即可，参考 GitHub 的<a target="_blank" rel="noopener" href="https://github.com/JuliaLang/Pkg.jl/issues/1585">讨论</a></p>
</li>
</ol>
<h3 id="帮助文档">帮助文档</h3>
<p>文档通常放在 <code>docs/</code> 目录下，Julia 用得最广的文档工具为 <code>Documenter.jl</code>，其他工具暂不介绍。</p>
<ol>
<li>
<p><code>Documenter.jl</code> 约定用 <code>docs/make.jl</code> 作为文档的主文件</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; <span class="comment"># 进入 shell 模式</span></span><br><span class="line">mkdir docs</span><br><span class="line">touch docs/make.jl</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>类似地，为文档设置开发环境</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">] <span class="comment"># 进入包管理模式</span></span><br><span class="line">activate docs <span class="comment"># 切换环境到 docs 目录</span></span><br><span class="line">add Documenter</span><br></pre></td></tr></table></figure>
<p>如果包未注册，可能需要添加 <code>dev .</code> 将开发中的包加入到 <code>doc</code> 环境依赖中，并添加 <code>Manifest.toml</code> 到 Git 记录</p>
</li>
<li>
<p>以 <code>QRDecoders</code> 为例，在 <code>docs/make.jl</code> 中添加如下内容</p>
 <figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DocMeta.setdocmeta!(QRDecoders, :DocTestSetup, :(<span class="keyword">using</span> QRDecoders); recursive=<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">makedocs(;</span><br><span class="line">    modules=[QRDecoders],</span><br><span class="line">    sitename=<span class="string">&quot;QRDecoders.jl&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">deploydocs(;</span><br><span class="line">    repo=<span class="string">&quot;github.com/JuliaImages/QRDecoders.jl&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>其中 <code>deploydocs</code> 设置文档部署的仓库地址</p>
</li>
<li>
<p>文档默认主页面根据 <code>docs/src</code> 目录下的 <code>index.md</code> 进行渲染。文件内容支持许多规则，比如用 <code>@docs</code> 和函数名可以将函数的帮助文档加入到页面中，如下图<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221027110711.png" alt="20221027110711"></p>
<p>对应到网页上，每个函数每个派发的文档都会展示出来<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221027111009.png" alt="20221027111009"></p>
</li>
<li>
<p>除了通过 GitHub 部署网页，也可以在本地生成预览，命令如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">julia --project=docs/  docs/make.jl</span><br></pre></td></tr></table></figure>
<p>激活 <code>docs</code> 环境并执行 <code>make.jl</code> 文件，执行后将在 <code>docs/build</code> 目录下生成网页，执行下边命令并打开浏览器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server --directory docs/build/ 8181</span><br></pre></td></tr></table></figure>
<p>其中 <code>8181</code> 为自定义的端口号，在网页中输入 <code>http://localhost:8181</code> 即可预览</p>
</li>
</ol>
<p>网页是基于 Markdown 语法编写的，相关规则以及 Julia 中的特殊用法推荐看社区的帖子：<a target="_blank" rel="noopener" href="https://discourse.juliacn.com/t/topic/2310">Markdown.jl 使用总结</a>或者 Julia 官方的 <a target="_blank" rel="noopener" href="https://docs.julialang.org/en/v1/stdlib/Markdown/#markdown_stdlib"> Markdown 手册</a>。</p>
<h3 id="代码覆盖率">代码覆盖率</h3>
<p>CodeCov 是非常实用的开发工具，很多开源仓库都用它来查看主代码文件被测试覆盖的比例，其对应由 <code>CI.yml</code> 文件中的 <code>julia-actions/julia-processcoverage@v1</code> 触发 。如果覆盖率降低会发出提示：<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221029091036.png" alt="深度截图_选择区域_20221029091036"></p>
<p>提示显示了主文件覆盖率的变化<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221029091711.png" alt="深度截图_选择区域_20221029091711"></p>
<p>点击查看代码，标红说明该行代码未被测试覆盖，也即存在错误的可能但未被测试捕捉<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221029090639.png" alt="深度截图_选择区域_20221029090639"></p>
<p>上图说明 <code>add!</code> 函数的测试样例不够全面，没有处理 <code>val = 0</code> 的情况。如果这里 <code>deleteat!</code> 错写成 <code>delete!</code>，错误也不会被发现。尽管bug 可能在之后被发现，但用 <code>CodeCov</code> 能提前规避潜在的错误。</p>
<p>一般地，<strong>代码覆盖率更高，说明作者代码认真做了测试，仓库可靠性也更高</strong>。</p>
<p>除此之外还有性能测试 <code>bench.jl</code> 等等很多可选内容，后续接触再进一步学习。<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221027120500.png" alt="深度截图_选择区域_20221027120500"></p>
<h2 id="包注册">包注册</h2>
<blockquote>
<p>推荐阅读<br>
Julia 包注册说明：<a target="_blank" rel="noopener" href="https://github.com/JuliaRegistries/General/blob/master/README.md">General registry README</a><br>
自动合并说明：<a target="_blank" rel="noopener" href="https://juliaregistries.github.io/RegistryCI.jl/stable/guidelines/"> AutoMerge guidelines</a><br>
注册机器人：<a target="_blank" rel="noopener" href="https://github.com/JuliaRegistries/Registrator.jl/blob/master/README.md">Registrator</a><br>
模块命名规范：<a target="_blank" rel="noopener" href="https://julialang.github.io/Pkg.jl/dev/creating-packages/#Package-naming-guidelines-1">Package naming guidelines</a></p>
</blockquote>
<p>这部分强烈建议看官方文档，包括常见 FAQ，以及自动合并的规则，帖子只简单介绍注册流程，遇到问题再查阅官方说明就行了。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/JuliaRegistries/General">JuliaRegistries/General</a> 是 Julia 包的注册表，其维护关于 Julia 包的信息，例如版本、依赖项和兼容性限制。</p>
<p>一般地，我们通过 JuliaRegistrator 向仓库提交 PR，更新包相关的 <code>.toml</code> 文件。相关文件并入主分支后，用户就能通过 <code>Pkg.add</code> 安装这个包了。</p>
<p>目前等待期如下：</p>
<ul>
<li>新的 Julia 包：3 天（这让社区有时间反馈）</li>
<li>现有软件包的新版本：15 分钟</li>
<li>JLL 包（二进制依赖项）：15 分钟，对于新包或新版本</li>
</ul>
<p>总之，包在第一次注册如果满足自动合并的要求，等待三天后就会自动合并仅仓库，此后升级小版本只需要等待 15 分钟。</p>
<h3 id="注册机器人">注册机器人</h3>
<p>进入包所在 GitHub 仓库，通过 <code>@JuliaRegistrator</code> 提出注册请求。</p>
<ol>
<li>
<p>方法一：在 issue 中输入 <code>@JuliaRegistrator register</code>，机器人就会根据 <code>Project.toml</code> 内容，自动生成 PR，并回复注册信息<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221028220206.png" alt="20221028220206"></p>
</li>
<li>
<p>方法二：打开最近的一个 commit，选择一行或者在底部输入消息：<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221028221204.png" alt="20221028221204"></p>
</li>
<li>
<p>方法三：在 JuliaHub 中点击注册<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221028220433.png" alt="深度截图_选择区域_20221028220433"><br>
这种方式注册的包可以不局限 GitHub 仓库<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221028220519.png" alt="20221028220519"></p>
</li>
</ol>
<p>如果触发机器人后，因为测试问题没有通过，则在个人仓库修改密码并重新输入 <code>@JuliaRegistrator register</code> 触发机器人。</p>
<h3 id="自动合并">自动合并</h3>
<p>官方列举了自动合并的要求，这里挑几个例子：</p>
<ol>
<li>包名称应以大写字母开头，仅包含 ASCII 字母数字字符，并且至少包含一个小写字母。</li>
<li>名称长度至少为 5 个字符。</li>
<li>名称不包括“julia”或以“Ju”开头。</li>
<li>有一个上限 <code>[compat]</code> 条目 julia 版本，它只包括有限数量的 Julia 重大版本。</li>
<li>依赖项：所有依赖项都应具有 <code>[compat]</code>上限条目</li>
<li>许可证：包应该有一个 OSI 批准的软件许可证，位于包代码的顶级目录中，<a target="_blank" rel="noopener" href="http://xn--LICENSELICENSE-466vmu0b5np6k3ydq19awtpuxmgg4ck8rx44h.md">例如在一个名为LICENSE或的文件中LICENSE.md</a></li>
<li>为防止名称相似的包之间的混淆，新包的名称还必须满足以下三项检查：
<ul>
<li>包名称与任何现有包的名称之间的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance">最小编辑距离</a>必须至少为 3</li>
<li>包名称的小写版本与任何现有包名称的小写版本之间的最小编辑距离必须至少为 2。</li>
<li>包名称和任何现有包之间的<a target="_blank" rel="noopener" href="https://github.com/ericphanson/VisualStringDistances.jl">VisualStringDistances.jl</a> 的视觉距离必须超过某个手动选择的阈值（当前为 2.5）</li>
</ul>
</li>
</ol>
<p>值得留意的几点，包需要符合<a target="_blank" rel="noopener" href="https://julialang.github.io/Pkg.jl/dev/creating-packages/#Package-naming-guidelines-1">命名规范</a>；确保不会有相近命名的包；确保包的依赖项都有 <code>[compat]</code> 条目（自带库比如 <code>SparseArray</code> 等不需要指定）。</p>
<p>如果自动合并失败，可以在 PR 中说明原因，然后等待人工审核。</p>
<h3 id="TagBot">TagBot</h3>
<p>包注册成功后，第一步用 PkgTemplates.jl 生成的 <code>TagBot.yml</code> 会让仓库自动生成 Release。此时，仓库的 <code>tag</code> 标签会记录该版本的状态<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/20221028223040.png" alt="20221028223040"></p>
<p>GitHub 右侧也可以看到 Release 的状态<br>
<img src="https://qiniu.wzhecnu.cn/PicBed3/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20221028223128.png" alt="深度截图_选择区域_20221028223128"></p>
<h2 id="小结">小结</h2>
<p>一般场景中，先用 <code>PkgTemplates.jl</code> 生成代码文件和部署文件，然后 <code>DocumenterTools</code> 生成密钥并添加到远端，剩下就是常规的代码编写了，非常简单。<br>
这些是最基础的用法，比如 <code>PkgTemplates.jl</code> 还能制作模板，文档测试还有其他工具等等，未来可以再一边摸索。</p>
<hr>
<h2 id="附录-函数文档">附录-函数文档</h2>
<p>这部分参考了 Document <a target="_blank" rel="noopener" href="https://docs.julialang.org/en/v1/manual/documentation/">官网教程</a>，可以看成 Documenter 前几节的翻译，更建议直接看官方文档。</p>
<ol>
<li>
<p>Julia 允许包开发人员能轻松地为函数、类型和其他对象编写文档。基本语法很简单：出现对象（函数、宏、类型或实例）顶部编写的字符串将被解释为文档（docstrings）。请注意，文档字符串和文档对象之间<strong>不能有空行或注释</strong>。这是一个基本示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;Tell whether there are too foo items in the array.&quot;</span><br><span class="line">foo(xs::Array) = ...</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>这是一个更复杂的例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">    bar(x[, y])</span><br><span class="line"></span><br><span class="line">Compute the Bar index between `x` and `y`.</span><br><span class="line"></span><br><span class="line">If `y` is unspecified, compute the Bar index between all pairs of columns of `x`.</span><br><span class="line"></span><br><span class="line"># Examples</span><br><span class="line">```julia-repl</span><br><span class="line">julia&gt; bar([1, 2], [1, 2])</span><br><span class="line">1</span><br><span class="line">```(排版原因忽略这个括号及内容)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">function bar(x, y=1) end</span><br></pre></td></tr></table></figure>
<p>显示效果如下：<br>
<img src="https://qiniu.wzhecnu.cn/PicBed2/picgo/20220507195430.png" alt="20220507195430"></p>
</li>
<li>
<p>补充说明：</p>
<ul>
<li>顶部前边放四个空格，可将函数名高亮，当第二参数可选时，应写为 <code>bar(x[, y])</code></li>
<li>在函数签名后，用单行句描述函数用途，如果需要的话，在一个空行之后，在第二段提供更详细的信息。撰写函数的文档时，单行语句应使用祈使结构（比如「Do this」、「Return that」）而非第三人称（不要写「Returns the length…」），并且应以句号结尾。如果函数的意义不能简单地总结，更好的方法是分成分开的组合句</li>
<li>不要自我重复：因为签名给出了函数名，所以没有必要用「The function bar…」开始文档：直接说要点。类似地，如果签名指定了参数的类型，在描述中提到这些是多余的。</li>
</ul>
</li>
<li>
<p>在 <code># Arguments</code> 下插入参数列表：<strong>只在确实必要时提供参数列表</strong>，对于简单函数，直接在函数目的中描述更合适。但对于拥有多个参数的（特别是含有关键字参数的）复杂函数来说，提供一个参数列表是个好主意，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Arguments</span><br><span class="line">- `n::Integer`: the number of elements to compute.</span><br><span class="line">- `dim::Integer=1`: the dimensions along which to perform the computation.</span><br></pre></td></tr></table></figure>
<p><img src="https://qiniu.wzhecnu.cn/PicBed2/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20220507200629.png" alt="深度截图_选择区域_20220507200629"></p>
</li>
<li>
<p>用 <code>See also:</code> 提供关联函数的引用，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">See also [`bar!`](@ref), [`baz`](@ref), [`baaz`](@ref).</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 <code># Examples</code> 中包含一些代码例子，示例应尽可能按 <code>doctest</code> 来写，具体在 Documenter 中一并介绍，示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">Some nice documentation here.</span><br><span class="line"></span><br><span class="line"># Examples</span><br><span class="line">```jldoctest</span><br><span class="line">julia&gt; a = [1 2; 3 4]</span><br><span class="line">2×2 Array&#123;Int64,2&#125;:</span><br><span class="line">1  2</span><br><span class="line">3  4</span><br><span class="line">```(排版原因忽略这个括号及内容)</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://qiniu.wzhecnu.cn/PicBed2/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20220507202119.png" alt="深度截图_选择区域_20220507202119"></p>
</li>
<li>
<p>使用反引号表示代码和<strong>方程</strong>，LaTeX 方程使用两个反引号，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`a = 1`</span><br><span class="line">``α = 1``</span><br></pre></td></tr></table></figure>
<p><img src="https://qiniu.wzhecnu.cn/PicBed2/picgo/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20220507202804.png" alt="深度截图_选择区域_20220507202804"></p>
</li>
<li>
<p>结尾的 <code>&quot;&quot;&quot;</code> 应单独一行（字符串末尾的空白字符会被自动 <code>strip</code> 掉）</p>
</li>
<li>
<p>代码中应遵守单行长度限制，即建议 <code>92</code> 个字符后换行</p>
</li>
<li>
<p>对长文档字符串，可以考虑使用 <code># Extend help</code> 来拆分文档</p>
</li>
<li>
<p>函数存在多个方法时，每个方法会用函数 <code>catdoc</code> 拼接</p>
</li>
</ol>
<p>以上。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Rex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.wzhecnu.cn/2022/10/25/programming/julia/julia-note-7-package/">http://www.wzhecnu.cn/2022/10/25/programming/julia/julia-note-7-package/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">文章采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明来自 <a href="http://www.wzhecnu.cn" target="_blank">学习空间</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Julia/">Julia</a></div><div class="post_share"><div class="social-share" data-image="https://qiniu.wzhecnu.cn/WallPapers/julia.jpg" data-sites="weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 请作者喝茶</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/15/programming/gsoc/qr-code-07-style/"><img class="prev-cover" src="https://qiniu.wzhecnu.cn/PicBed2/picgo/21_088cd0b624d90f8847029f939a3fc37a.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">二维码学习笔记(七) | 特殊样式</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/02/programming/gsoc/qr-code-02/"><img class="next-cover" src="https://qiniu.wzhecnu.cn/PicBed2/picgo/21_088cd0b624d90f8847029f939a3fc37a.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">二维码学习笔记(二) | 数据分析与数据编码</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/03/25/programming/data-structure/leetcode-note-01/" title="LeetCode 刷题笔记"><img class="cover" src="https://qiniu.wzhecnu.cn/PicBed2/picgo/20220224215248.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-25</div><div class="title">LeetCode 刷题笔记</div></div></a></div><div><a href="/2022/03/05/programming/julia/julia-algebra/" title="Julia 学习笔记(番外) | 当 Julia 遇上 OSCAR"><img class="cover" src="https://qiniu.wzhecnu.cn/PicBed2/picgo/20220307111919.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-05</div><div class="title">Julia 学习笔记(番外) | 当 Julia 遇上 OSCAR</div></div></a></div><div><a href="/2021/10/18/programming/julia/julia-intro/" title="Julia 基本使用及安装教程"><img class="cover" src="https://qiniu.wzhecnu.cn/WallPapers/julia.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-18</div><div class="title">Julia 基本使用及安装教程</div></div></a></div><div><a href="/2021/10/31/programming/julia/julia-note-2/" title="Julia 学习笔记(二) | 类型，派发与设计模式"><img class="cover" src="https://qiniu.wzhecnu.cn/WallPapers/julia.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-31</div><div class="title">Julia 学习笔记(二) | 类型，派发与设计模式</div></div></a></div><div><a href="/2021/10/18/programming/julia/julia-note-1/" title="Julia 学习笔记(一) | 数据类型和函数"><img class="cover" src="https://qiniu.wzhecnu.cn/WallPapers/julia.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-18</div><div class="title">Julia 学习笔记(一) | 数据类型和函数</div></div></a></div><div><a href="/2021/10/31/programming/julia/julia-note-3/" title="Julia 学习笔记(三) | 广播，性能和模块"><img class="cover" src="https://qiniu.wzhecnu.cn/WallPapers/julia.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-31</div><div class="title">Julia 学习笔记(三) | 广播，性能和模块</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Rex</div><div class="author-info__description">Math + Computer = ?</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">86</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/RexWzh"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/RexWzh" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="https://space.bilibili.com/518870168" target="_blank" title="B站"><i class="iconfont icon--bilibili"></i></a><a class="social-icon" href="https://www.zhihu.com/people/wang-zhi-hong-79-21" target="_blank" title="知乎"><i class="iconfont icon-zhihu"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">新功能陆续上线，欢迎交流！干杯！！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%94%A0%E5%94%A0%E9%97%B2%E8%AF%9D"><span class="toc-number">1.</span> <span class="toc-text">唠唠闲话</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%A6%81"><span class="toc-number">1.1.</span> <span class="toc-text">概要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90"><span class="toc-number">2.</span> <span class="toc-text">模板生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PkgTemplate"><span class="toc-number">2.1.</span> <span class="toc-text">PkgTemplate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CI-%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">CI 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DocumentTools"><span class="toc-number">2.3.</span> <span class="toc-text">DocumentTools</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%EF%BC%8C%E6%96%87%E6%A1%A3%E5%92%8C%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-number">3.</span> <span class="toc-text">测试，文档和覆盖率</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%B5%8B%E8%AF%95"><span class="toc-number">3.1.</span> <span class="toc-text">代码测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3"><span class="toc-number">3.2.</span> <span class="toc-text">帮助文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-number">3.3.</span> <span class="toc-text">代码覆盖率</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E6%B3%A8%E5%86%8C"><span class="toc-number">4.</span> <span class="toc-text">包注册</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="toc-number">4.1.</span> <span class="toc-text">注册机器人</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%90%88%E5%B9%B6"><span class="toc-number">4.2.</span> <span class="toc-text">自动合并</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TagBot"><span class="toc-number">4.3.</span> <span class="toc-text">TagBot</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95-%E5%87%BD%E6%95%B0%E6%96%87%E6%A1%A3"><span class="toc-number">6.</span> <span class="toc-text">附录-函数文档</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Rex</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<a href="https://beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">粤ICP备2021109780号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.wzhecnu.cn',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo.wzhecnu.cn',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="true" data-text="欢,迎,来,访,你,好,朋,友" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>