<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>streamlit-å®æˆ˜-rag | å­¦ä¹ ç©ºé—´</title><meta name="author" content="Rex"><meta name="copyright" content="Rex"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å” å” é—²è¯ (å¯¹ Streamlit åšä¸€äº›ä»‹ç»)  é…ç½® Streamlit åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆè¿è¡Œ streamlit run çš„ä½ç½®ï¼‰ï¼Œåˆ›å»º .streamlit ç›®å½•ï¼Œåˆ›å»º config.toml æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 123[server]enableCORS &#x3D; falseport &#x3D; 8501 # æŒ‡å®šç«¯å£ï¼Œå»ºè®®ä¿®æ”¹ (è¡¥å……å‡ ä¸ªå¸¸ç”¨å‚æ•°ï¼Œä»‹ç» config.toml çš„ä½œç”¨) æŒ‡å®šå¯†é’¥å˜é‡">
<meta property="og:type" content="article">
<meta property="og:title" content="streamlit-å®æˆ˜-rag">
<meta property="og:url" content="http://www.wzhecnu.cn/2024/01/26/gpt/streamlit-shi-zhan-rag/index.html">
<meta property="og:site_name" content="å­¦ä¹ ç©ºé—´">
<meta property="og:description" content="å” å” é—²è¯ (å¯¹ Streamlit åšä¸€äº›ä»‹ç»)  é…ç½® Streamlit åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆè¿è¡Œ streamlit run çš„ä½ç½®ï¼‰ï¼Œåˆ›å»º .streamlit ç›®å½•ï¼Œåˆ›å»º config.toml æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 123[server]enableCORS &#x3D; falseport &#x3D; 8501 # æŒ‡å®šç«¯å£ï¼Œå»ºè®®ä¿®æ”¹ (è¡¥å……å‡ ä¸ªå¸¸ç”¨å‚æ•°ï¼Œä»‹ç» config.toml çš„ä½œç”¨) æŒ‡å®šå¯†é’¥å˜é‡">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/zhihu.jpg">
<meta property="article:published_time" content="2024-01-26T01:58:36.000Z">
<meta property="article:modified_time" content="2024-01-26T04:52:53.251Z">
<meta property="article:author" content="Rex">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/zhihu.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.wzhecnu.cn/2024/01/26/gpt/streamlit-shi-zhan-rag/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/iconfont.css"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":300},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'streamlit-å®æˆ˜-rag',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-26 12:52:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script>(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();</script><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">92</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/zhihu.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">å­¦ä¹ ç©ºé—´</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">streamlit-å®æˆ˜-rag</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘å¸ƒäº</span><time class="post-meta-date-created" datetime="2024-01-26T01:58:36.000Z" title="å‘å¸ƒäº 2024-01-26 09:58:36">2024-01-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-01-26T04:52:53.251Z" title="æ›´æ–°äº 2024-01-26 12:52:53">2024-01-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">866</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>3åˆ†é’Ÿ</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="å” å” é—²è¯">å” å” é—²è¯</h2>
<p>(å¯¹ Streamlit åšä¸€äº›ä»‹ç»)</p>
<hr>
<h2 id="é…ç½®-Streamlit">é…ç½® Streamlit</h2>
<p>åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆè¿è¡Œ streamlit run çš„ä½ç½®ï¼‰ï¼Œåˆ›å»º <code>.streamlit</code> ç›®å½•ï¼Œåˆ›å»º <code>config.toml</code> æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="attr">enableCORS</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">8501</span> <span class="comment"># æŒ‡å®šç«¯å£ï¼Œå»ºè®®ä¿®æ”¹</span></span><br></pre></td></tr></table></figure>
<p>(è¡¥å……å‡ ä¸ªå¸¸ç”¨å‚æ•°ï¼Œä»‹ç» config.toml çš„ä½œç”¨)</p>
<p>æŒ‡å®šå¯†é’¥å˜é‡ï¼Œ<code>secrets.toml</code></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">openai_key</span> = <span class="string">&quot;sk-qrn8GAZmgwRVMjLE4LKo2EuKoEuOs4qVhUJigJLHx7RNE2PQ&quot;</span></span><br><span class="line"><span class="attr">api_base</span> = <span class="string">&quot;https://api.chatanywhere.tech/v1&quot;</span></span><br></pre></td></tr></table></figure>
<p>ï¼ˆè¡¥å…… secrets.toml çš„ç”¨æ³•ï¼‰</p>
<h2 id="ä»£ç è§£æ">ä»£ç è§£æ</h2>
<h3 id="å¯¼å…¥æ¨¡å—">å¯¼å…¥æ¨¡å—</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">from</span> llama_index <span class="keyword">import</span> VectorStoreIndex, ServiceContext, StorageContext, load_index_from_storage</span><br><span class="line"><span class="keyword">from</span> llama_index.llms <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> llama_index <span class="keyword">import</span> SimpleDirectoryReader</span><br><span class="line"><span class="keyword">import</span> openai, os</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­</p>
<ul>
<li><code>VectorStoreIndex</code> ä»æ–‡æ¡£æ„å»ºå‘é‡ç´¢å¼•ï¼ŒLlamaIndex é»˜è®¤æ”¯æŒçš„æ–¹æ³•</li>
<li><code>ServiceContext</code> æ˜¯æœåŠ¡ä¸Šä¸‹æ–‡ï¼Œå®šåˆ¶æ¨¡å‹å’Œ Embedding ç­‰</li>
<li><code>StorageContext</code> æ˜¯å­˜å‚¨ä¸Šä¸‹æ–‡ï¼Œå®šåˆ¶å­˜å‚¨åº“</li>
<li><code>load_index_from_storage</code> ç”¨äºä»æœ¬åœ°åŠ è½½ç´¢å¼•</li>
<li><code>SimpleDirectoryReader</code> é»˜è®¤çš„ç›®å½•è¯»å–å™¨</li>
<li><code>OpenAI</code> æ˜¯ LlamaIndex å¯¹ OpenAI çš„å°è£…</li>
</ul>
<h3 id="åŠ è½½é…ç½®">åŠ è½½é…ç½®</h3>
<p>ï¼ˆæ‹†åˆ†ï¼Œå¹¶å±•å¼€ä»£ç ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">system_prompt = <span class="string">&quot;ä½ æ˜¯ Streamlit Python åº“çš„ä¸“å®¶ï¼Œä½ çš„å·¥ä½œæ˜¯å›ç­”æŠ€æœ¯é—®é¢˜ã€‚å‡è®¾æ‰€æœ‰é—®é¢˜éƒ½ä¸ Streamlit Pythonåº“æœ‰å…³ã€‚è¯·ä¿æŒæ‚¨çš„ç­”æ¡ˆä¸“ä¸šä¸”åŸºäºäº‹å® - ä¸è¦è™šæ„å›ç­”ã€‚&quot;</span></span><br><span class="line"><span class="comment"># LlamaIndex æ”¯æŒå‡ ç§èŠå¤©å¼•æ“</span></span><br><span class="line">chat_model_options = [<span class="string">&quot;simple&quot;</span>, <span class="string">&quot;condense_question&quot;</span>, <span class="string">&quot;context&quot;</span>, <span class="string">&quot;condense_plus_context&quot;</span>, <span class="string">&quot;react&quot;</span>, <span class="string">&quot;openai&quot;</span>, <span class="string">&quot;best&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥çŸ¥è¯†åº“</span></span><br><span class="line">PERSIST_DIR = <span class="string">&quot;.cache/storage&quot;</span> <span class="comment"># ä¿å­˜ç´¢å¼•ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># æ¼”ç¤ºçš„çŸ¥è¯†åº“åœ°å€ï¼šhttps://github.com/carolinedlu/llamaindex-chat-with-streamlit-docs/tree/main/data</span></span><br><span class="line"><span class="comment"># é¦–æ¬¡è¿è¡Œï¼Œåˆ›å»ºç´¢å¼•</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(PERSIST_DIR):</span><br><span class="line">    <span class="comment"># å¯¼å…¥æ•°æ®</span></span><br><span class="line">    documents = SimpleDirectoryReader(<span class="string">&quot;.cache/data&quot;</span>).load_data()</span><br><span class="line">    <span class="comment"># æœ¬åœ°å®šåˆ¶</span></span><br><span class="line">    service_context = ServiceContext.from_defaults(embed_model=<span class="string">&quot;local:/sshfs/pretrains/moka-ai/m3e-base&quot;</span>)</span><br><span class="line">    <span class="comment"># ç´¢å¼•æ•°æ®</span></span><br><span class="line">    index = VectorStoreIndex.from_documents(documents, service_context=service_context)</span><br><span class="line">    index.storage_context.persist(persist_dir=PERSIST_DIR)</span><br><span class="line"><span class="comment"># else: # ç›´æ¥è¯»å– Index</span></span><br><span class="line"><span class="comment">#     storage_context = StorageContext.from_defaults(persist_dir=PERSIST_DIR)</span></span><br><span class="line"><span class="comment">#     index = load_index_from_storage(storage_context, service_context=service_context)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼“å­˜åˆ°å†…å­˜</span></span><br><span class="line"><span class="meta">@st.cache_resource(<span class="params">show_spinner=<span class="literal">False</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_data</span>():</span><br><span class="line">    <span class="keyword">with</span> st.spinner(text=<span class="string">&quot;æ­£åœ¨å¯¼å…¥ç´¢å¼•æ•°æ®ï¼Œè¯·ç¨ç­‰&quot;</span>):</span><br><span class="line">        <span class="comment"># å®šåˆ¶æœåŠ¡ä¸Šä¸‹æ–‡</span></span><br><span class="line">        service_context = ServiceContext.from_defaults(</span><br><span class="line">             llm=OpenAI(model=<span class="string">&quot;gpt-3.5-turbo&quot;</span>, temperature=<span class="number">0.5</span>, system_prompt=system_prompt)</span><br><span class="line">            , embed_model=<span class="string">&quot;local:/sshfs/pretrains/moka-ai/m3e-base&quot;</span>)</span><br><span class="line">        <span class="comment"># ä»æœ¬åœ°è¯»å–ç´¢å¼•</span></span><br><span class="line">        storage_context = StorageContext.from_defaults(persist_dir=PERSIST_DIR)</span><br><span class="line">        index = load_index_from_storage(storage_context, service_context=service_context)</span><br><span class="line">        <span class="keyword">return</span> index</span><br><span class="line">index = load_data()</span><br></pre></td></tr></table></figure>
<h3 id="Streamlit-ä»£ç ">Streamlit ä»£ç </h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">st.header(<span class="string">&quot;ä½¿ç”¨ Streamlit æ–‡æ¡£è¿›è¡Œé—®ç­” ğŸ’¬ ğŸ“š&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state.keys(): <span class="comment"># åˆå§‹åŒ–çŠ¶æ€ä¸­çš„ `message` é€‰é¡¹</span></span><br><span class="line">    st.session_state.messages = [</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;è¯·æé—®å…³äº Streamlit å¼€æº Python åº“çš„é—®é¢˜ï¼&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line"><span class="comment"># Session State is a way to share variables between reruns, for each user session. In addition to the ability to store and persist state, Streamlit also exposes the ability to manipulate state using Callbacks. Session state also persists across apps inside a multipage app.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> st.sidebar:</span><br><span class="line">    st.title(<span class="string">&quot;è®¾ç½®&quot;</span>)</span><br><span class="line">    <span class="comment"># æ¨¡å‹é€‰æ‹©</span></span><br><span class="line">    model_option = st.selectbox(<span class="string">&quot;é€‰æ‹©å¯¹è¯å¼•æ“&quot;</span>, options=chat_model_options, index=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">    uploaded_file = st.file_uploader(<span class="string">&quot;ä¸Šä¼ æ–‡ä»¶(å¾…æ”¯æŒ)&quot;</span>, <span class="built_in">type</span>=[<span class="string">&quot;txt&quot;</span>, <span class="string">&quot;csv&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;md&quot;</span>], accept_multiple_files=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># ç´¢å¼•ä¸Šä¼ çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¯¹è¯å¼•æ“ condense_question react</span></span><br><span class="line">chat_engine = index.as_chat_engine(chat_mode=model_option, verbose=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># è¾“å…¥é—®é¢˜</span></span><br><span class="line">prompt = st.chat_input(<span class="string">&quot;è¯·æé—®...&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> prompt: <span class="comment"># æ·»åŠ åˆ°å¯¹è¯</span></span><br><span class="line">    st.session_state.messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;)</span><br><span class="line"><span class="comment"># æ›´æ–°å¯¹è¯å†å²</span></span><br><span class="line"><span class="keyword">for</span> message <span class="keyword">in</span> st.session_state.messages:</span><br><span class="line">    <span class="keyword">with</span> st.chat_message(message[<span class="string">&quot;role&quot;</span>]):</span><br><span class="line">        st.write(message[<span class="string">&quot;content&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># é assistant è§’è‰²ï¼Œè°ƒç”¨å¯¹è¯å¼•æ“</span></span><br><span class="line"><span class="keyword">if</span> st.session_state.messages[-<span class="number">1</span>][<span class="string">&quot;role&quot;</span>] != <span class="string">&quot;assistant&quot;</span>:</span><br><span class="line">    <span class="keyword">with</span> st.chat_message(<span class="string">&quot;assistant&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> st.spinner(<span class="string">&quot;æ€è€ƒä¸­...&quot;</span>):</span><br><span class="line">            response = chat_engine.chat(prompt) <span class="comment"># è°ƒç”¨å¯¹è¯å¼•æ“</span></span><br><span class="line">            st.write(response.response) <span class="comment"># å†™å…¥å›å¤</span></span><br><span class="line">            message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: response.response&#125;</span><br><span class="line">            st.session_state.messages.append(message) <span class="comment"># æ·»åŠ åˆ°å¯¹è¯å†å²</span></span><br><span class="line"><span class="comment"># å¾…æ”¯æŒ</span></span><br><span class="line"><span class="keyword">if</span> uploaded_file <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>Q: Streamlit ä¸Šä¼ åï¼Œæ–‡ä»¶æ”¾åœ¨å“ªäº†ï¼Ÿ<br>
Q2: æ·»åŠ ä¸€ä¸ªé€‰é¡¹ï¼Œåˆ‡æ¢æœ¬åœ°æ–‡ä»¶å’Œé»˜è®¤æ–‡ä»¶ï¼ˆè¿™æ—¶å€™å‰ç«¯å¯èƒ½è¦ç›¸åº”ä¿®æ”¹ï¼Ÿï¼‰</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Rex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://www.wzhecnu.cn/2024/01/26/gpt/streamlit-shi-zhan-rag/">http://www.wzhecnu.cn/2024/01/26/gpt/streamlit-shi-zhan-rag/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æ–‡ç« é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://www.wzhecnu.cn" target="_blank">å­¦ä¹ ç©ºé—´</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/zhihu.jpg" data-sites="weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> è¯·ä½œè€…å–èŒ¶</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/26/vim-usage/"><img class="prev-cover" src="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/zhihu.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">vim-usage</div></div></a></div><div class="next-post pull-right"><a href="/2024/01/26/gradio-shi-zhan-tts/"><img class="next-cover" src="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/zhihu.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">gradio-å®æˆ˜-tts</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://qiniu.wzhecnu.cn/PicBed5/images_for_blogs/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Rex</div><div class="author-info__description">Math + Computer = ?</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">92</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">26</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/RexWzh"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/RexWzh" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="https://space.bilibili.com/518870168" target="_blank" title="Bç«™"><i class="iconfont icon--bilibili"></i></a><a class="social-icon" href="https://www.zhihu.com/people/wang-zhi-hong-79-21" target="_blank" title="çŸ¥ä¹"><i class="iconfont icon-zhihu"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ–°åŠŸèƒ½é™†ç»­ä¸Šçº¿ï¼Œæ¬¢è¿äº¤æµï¼å¹²æ¯ï¼ï¼ï¼</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%94%A0%E5%94%A0%E9%97%B2%E8%AF%9D"><span class="toc-number">1.</span> <span class="toc-text">å” å” é—²è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Streamlit"><span class="toc-number">2.</span> <span class="toc-text">é…ç½® Streamlit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">ä»£ç è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97"><span class="toc-number">3.1.</span> <span class="toc-text">å¯¼å…¥æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">åŠ è½½é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Streamlit-%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">Streamlit ä»£ç </span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Rex</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<a href="https://beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">ç²¤ICPå¤‡2021109780å·</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.wzhecnu.cn',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo.wzhecnu.cn',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="true" data-text="æ¬¢,è¿,æ¥,è®¿,ä½ ,å¥½,æœ‹,å‹" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>